{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/user/tienda/src/components/ui/card.tsx"],"sourcesContent":["\nimport * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AACA;AAEA;;;;AAEA,MAAM,qBAAO,2KAAgB,MAG3B,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,4DACA;QAED,GAAG,KAAK;;;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,2KAAgB,OAGjC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,2KAAgB,OAGhC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,sDACA;QAED,GAAG,KAAK;;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,2KAAgB,OAGtC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,2KAAgB,OAGlC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QAAI,KAAK;QAAK,WAAW,IAAA,4HAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,2KAAgB,QAGjC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 129, "column": 0}, "map": {"version":3,"sources":["file:///home/user/tienda/src/components/dashboard/stat-card.tsx"],"sourcesContent":["\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { cn } from \"@/lib/utils\";\nimport type { LucideIcon } from \"lucide-react\";\n\ninterface StatCardProps {\n  title: string;\n  value: string;\n  icon: LucideIcon;\n  description: string;\n  variant?: \"default\" | \"destructive\" | \"success\" | \"info\";\n}\n\nexport default function StatCard({ title, value, icon: Icon, description, variant = 'default' }: StatCardProps) {\n  \n  const variants = {\n    default: {\n      card: \"border-primary/20 hover:border-primary/50\",\n      iconContainer: \"bg-primary/10\",\n      icon: \"text-primary\",\n    },\n    destructive: {\n      card: \"border-destructive/20 hover:border-destructive/50\",\n      iconContainer: \"bg-destructive/10\",\n      icon: \"text-destructive\",\n    },\n    success: {\n       card: \"border-emerald-500/20 hover:border-emerald-500/50\",\n       iconContainer: \"bg-emerald-500/10\",\n       icon: \"text-emerald-600\",\n    },\n    info: {\n       card: \"border-sky-500/20 hover:border-sky-500/50\",\n       iconContainer: \"bg-sky-500/10\",\n       icon: \"text-sky-600\",\n    }\n  }\n  \n  const selectedVariant = variants[variant] || variants.default;\n\n  return (\n    <Card className={cn(\n        \"transition-all duration-300 hover:shadow-xl hover:-translate-y-1 backdrop-blur-sm bg-background/50 border\",\n        selectedVariant.card\n    )}>\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">{title}</CardTitle>\n        <div className={cn(\"flex items-center justify-center rounded-lg p-2\", selectedVariant.iconContainer)}>\n            <Icon className={cn(\"h-5 w-5\", selectedVariant.icon)} />\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-2xl font-bold\">{value}</div>\n        <p className=\"text-xs text-muted-foreground\">{description}</p>\n      </CardContent>\n    </Card>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AAMA;;;;AAWe,SAAS,SAAS,KAA6E;QAA7E,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,IAAI,EAAE,WAAW,EAAE,UAAU,SAAS,EAAiB,GAA7E;IAE/B,MAAM,WAAW;QACf,SAAS;YACP,MAAM;YACN,eAAe;YACf,MAAM;QACR;QACA,aAAa;YACX,MAAM;YACN,eAAe;YACf,MAAM;QACR;QACA,SAAS;YACN,MAAM;YACN,eAAe;YACf,MAAM;QACT;QACA,MAAM;YACH,MAAM;YACN,eAAe;YACf,MAAM;QACT;IACF;IAEA,MAAM,kBAAkB,QAAQ,CAAC,QAAQ,IAAI,SAAS,OAAO;IAE7D,qBACE,6LAAC,2IAAI;QAAC,WAAW,IAAA,4HAAE,EACf,6GACA,gBAAgB,IAAI;;0BAEtB,6LAAC,iJAAU;gBAAC,WAAU;;kCACpB,6LAAC,gJAAS;wBAAC,WAAU;kCAA6C;;;;;;kCAClE,6LAAC;wBAAI,WAAW,IAAA,4HAAE,EAAC,mDAAmD,gBAAgB,aAAa;kCAC/F,cAAA,6LAAC;4BAAK,WAAW,IAAA,4HAAE,EAAC,WAAW,gBAAgB,IAAI;;;;;;;;;;;;;;;;;0BAGzD,6LAAC,kJAAW;;kCACV,6LAAC;wBAAI,WAAU;kCAAsB;;;;;;kCACrC,6LAAC;wBAAE,WAAU;kCAAiC;;;;;;;;;;;;;;;;;;AAItD;KA5CwB","debugId":null}},
    {"offset": {"line": 239, "column": 0}, "map": {"version":3,"sources":["file:///home/user/tienda/src/lib/actions/setup.ts"],"sourcesContent":["\n\n\n'use server';\n\nimport type { InitialAdminData, User, Category, NewUserData, Product, Sale, CashOutflow, Inflow, Currency, CashTransfer, Company, UserRole, OrderItem, OrderDraft } from \"@/lib/types\";\nimport { adminDb, adminAuth } from \"../firebase/server\";\nimport { FieldValue } from \"firebase-admin/firestore\";\nimport { getFunctions, httpsCallable, HttpsCallable } from \"firebase/functions\";\nimport { reauthenticateWithCredential, EmailAuthProvider, signInWithEmailAndPassword } from \"firebase/auth\";\nimport { auth as clientAuth, app as clientApp } from \"../firebase/client\";\n\n// Cart type for server action\ntype PlainCartItem = {\n    id: string;\n    quantityInCart: number;\n    name: string;\n}\n\n\n// -----------------\n// Helpers Admin\n// -----------------\nconst getAdminDbOrThrow = () => {\n  if (!adminDb) throw new Error(\"La base de datos de administrador no está configurada.\");\n  return adminDb;\n};\n\nconst getAdminAuthOrThrow = () => {\n  if (!adminAuth) throw new Error(\"La autenticación de administrador no está configurada.\");\n  return adminAuth;\n};\n\nexport async function getCompanyIdForUser(userId: string): Promise<string> {\n    const db = getAdminDbOrThrow();\n    const userRef = db.doc(`users/${userId}`);\n    const userSnap = await userRef.get();\n    if (!userSnap.exists || !userSnap.data()?.companyId) {\n        throw new Error(\"Usuario no asociado a ninguna empresa.\");\n    }\n    return userSnap.data()!.companyId;\n};\n\n// -----------------\n// Setup inicial\n// -----------------\nexport async function isInitialSetupRequired(): Promise<boolean> {\n  const db = getAdminDbOrThrow();\n  const companiesCol = db.collection(\"companies\");\n  const snapshot = await companiesCol.limit(1).get();\n  return snapshot.empty;\n};\n\nexport async function createInitialAdminUser(data: Omit<InitialAdminData, 'secretCode'>) {\n  const db = getAdminDbOrThrow();\n  const auth = getAdminAuthOrThrow();\n  const companyRef = db.collection(\"companies\").doc();\n  const userRecord = await auth.createUser({\n    email: data.email,\n    password: data.password,\n    displayName: data.adminName,\n  });\n\n  await auth.setCustomUserClaims(userRecord.uid, {\n    role: \"primary-admin\",\n    companyId: companyRef.id,\n  });\n\n  const batch = db.batch();\n\n  batch.set(companyRef, {\n    id: companyRef.id,\n    name: data.companyName,\n    ownerUid: userRecord.uid,\n    exchangeRate: 36.5,\n    pettyCashInitial: 0,\n    createdAt: FieldValue.serverTimestamp(),\n    logoUrl: \"\",\n    securityCodeSet: false, // Initialize security code status\n  });\n\n  const userRef = db.doc(`users/${userRecord.uid}`);\n  batch.set(userRef, {\n    uid: userRecord.uid,\n    name: data.adminName,\n    email: data.email,\n    role: \"primary-admin\",\n    companyId: companyRef.id,\n    createdAt: FieldValue.serverTimestamp(),\n  });\n\n  await batch.commit();\n\n  return { uid: userRecord.uid, companyId: companyRef.id };\n};\n\n// -----------------\n// Company Settings\n// -----------------\n\nexport async function updateCompanySettings(settings: Partial<Pick<Company, 'exchangeRate' | 'pettyCashInitial' | 'name' | 'logoUrl'>>, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const companyRef = db.doc(`companies/${companyId}`);\n    \n    const validSettings: { [key: string]: any } = {};\n    if (typeof settings.exchangeRate === 'number') {\n        validSettings.exchangeRate = settings.exchangeRate;\n    }\n    if (typeof settings.pettyCashInitial === 'number') {\n        validSettings.pettyCashInitial = settings.pettyCashInitial;\n    }\n    if (typeof settings.name === 'string' && settings.name.length > 0) {\n        validSettings.name = settings.name;\n    }\n    if (typeof settings.logoUrl === 'string') {\n        validSettings.logoUrl = settings.logoUrl;\n    }\n\n    if (Object.keys(validSettings).length > 0) {\n        await companyRef.update(validSettings);\n    }\n}\n\n\n// -----------------\n// Gestión de usuarios\n// -----------------\nexport async function addUser(userData: NewUserData, adminUserId: string) {\n    const auth = getAdminAuthOrThrow();\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(adminUserId);\n\n    if (userData.role !== 'admin' && userData.role !== 'employee') {\n        throw new Error(\"Rol de usuario no válido.\");\n    }\n\n    try {\n        const userRecord = await auth.createUser({\n            email: userData.email,\n            password: userData.password,\n            displayName: userData.name,\n        });\n        \n        await auth.setCustomUserClaims(userRecord.uid, { role: userData.role, companyId });\n\n        const newUserDocRef = db.doc(`users/${userRecord.uid}`);\n        await newUserDocRef.set({\n            uid: userRecord.uid,\n            name: userData.name,\n            email: userData.email,\n            role: userData.role,\n            companyId: companyId,\n            createdAt: FieldValue.serverTimestamp(),\n        });\n\n        return { uid: userRecord.uid };\n\n    } catch(error: any) {\n        if (error.code === 'auth/email-already-exists') {\n            throw new Error('Este correo electrónico ya está registrado.');\n        }\n        console.error(\"Error creating user:\", error);\n        throw new Error('No se pudo crear el usuario. ' + error.message);\n    }\n};\n\nexport async function updateUserRole(userIdToUpdate: string, newRole: UserRole, currentAdminId: string) {\n    const auth = getAdminAuthOrThrow();\n    const db = getAdminDbOrThrow();\n\n    const [companyId, { customClaims: adminClaims }] = await Promise.all([\n        getCompanyIdForUser(currentAdminId),\n        auth.getUser(currentAdminId),\n    ]);\n\n    if (newRole === 'primary-admin') {\n        throw new Error(\"La transferencia de propiedad debe hacerse a través de la acción 'transferPrimaryAdmin'.\");\n    }\n\n    const userToUpdateRef = db.doc(`users/${userIdToUpdate}`);\n    const userDoc = await userToUpdateRef.get();\n\n    if (!userDoc.exists || userDoc.data()?.companyId !== companyId) {\n        throw new Error(\"El usuario a modificar no pertenece a la misma empresa.\");\n    }\n\n    const targetUserRole = userDoc.data()?.role;\n\n    if (adminClaims?.role === 'admin' && (targetUserRole === 'admin' || targetUserRole === 'primary-admin')) {\n        throw new Error(\"Un administrador no puede modificar a otro administrador o al propietario.\");\n    }\n    \n    await auth.setCustomUserClaims(userIdToUpdate, { role: newRole, companyId });\n    await userToUpdateRef.update({ role: newRole });\n}\n\n\nexport async function transferPrimaryAdmin(targetUserId: string, currentAdminId: string) {\n    const auth = getAdminAuthOrThrow();\n    const db = getAdminDbOrThrow();\n\n    const { customClaims: adminClaims } = await auth.getUser(currentAdminId);\n\n    if (adminClaims?.role !== 'primary-admin') {\n        throw new Error(\"Solo el propietario actual puede transferir la propiedad.\");\n    }\n\n    const companyId = adminClaims.companyId;\n\n    const targetUserRef = db.doc(`users/${targetUserId}`);\n    const targetUserDoc = await targetUserRef.get();\n\n    if (!targetUserDoc.exists || targetUserDoc.data()?.companyId !== companyId) {\n        throw new Error(\"El usuario objetivo no pertenece a la misma empresa.\");\n    }\n    \n    const batch = db.batch();\n    const currentAdminUserRef = db.doc(`users/${currentAdminId}`);\n\n    // Update custom claims\n    await Promise.all([\n        auth.setCustomUserClaims(targetUserId, { role: 'primary-admin', companyId }),\n        auth.setCustomUserClaims(currentAdminId, { role: 'admin', companyId })\n    ]);\n    \n    // Update user documents in Firestore\n    batch.update(targetUserRef, { role: 'primary-admin' });\n    batch.update(currentAdminUserRef, { role: 'admin' });\n    \n    await batch.commit();\n}\n\n\nexport async function deleteUser(userIdToDelete: string, currentAdminId: string) {\n    const auth = getAdminAuthOrThrow();\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(currentAdminId);\n\n    const userToDeleteRef = db.doc(`users/${userIdToDelete}`);\n    const userDoc = await userToDeleteRef.get();\n\n    if (!userDoc.exists || userDoc.data()?.companyId !== companyId) {\n        throw new Error(\"El usuario a eliminar no pertenece a tu empresa.\");\n    }\n\n    if (userDoc.data()?.role === 'primary-admin') {\n        throw new Error(\"No se puede eliminar al propietario de la empresa.\");\n    }\n\n    await auth.deleteUser(userIdToDelete);\n    await userToDeleteRef.delete();\n}\n\n\n// -----------------\n// Category Management\n// -----------------\nexport async function addCategory(categoryName: string, userId: string): Promise<string> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const categoryCollection = db.collection(`companies/${companyId}/categories`);\n    \n    const existingCategoryQuery = await categoryCollection.where('name', '==', categoryName).limit(1).get();\n    if (!existingCategoryQuery.empty) {\n        return existingCategoryQuery.docs[0].id;\n    }\n    \n    const newCategoryRef = await categoryCollection.add({ name: categoryName });\n    return newCategoryRef.id;\n};\n\nexport async function deleteCategory(categoryId: string, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    \n    const categoryRef = db.doc(`companies/${companyId}/categories/${categoryId}`);\n    const productsRef = db.collection(`companies/${companyId}/products`);\n    \n    const productsQuery = productsRef.where('categoryId', '==', categoryId);\n    const productsSnapshot = await productsQuery.get();\n    \n    const batch = db.batch();\n    \n    productsSnapshot.forEach(doc => {\n      batch.update(doc.ref, { categoryId: \"\" });\n    });\n    \n    batch.delete(categoryRef);\n    \n    await batch.commit();\n};\n\n\n// -----------------\n// Product Management\n// -----------------\nexport async function addProduct(productData: Omit<Product, 'id'>, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const productCollection = db.collection(`companies/${companyId}/products`);\n    await productCollection.add({\n        ...productData,\n        createdAt: FieldValue.serverTimestamp(),\n    });\n};\n\nexport async function addMultipleProducts(productsData: Omit<Product, 'id'>[], userId: string): Promise<{ successCount: number; errorCount: number; }> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const productCollection = db.collection(`companies/${companyId}/products`);\n    \n    let successCount = 0;\n    let errorCount = 0;\n\n    const batchSize = 500;\n    for (let i = 0; i < productsData.length; i += batchSize) {\n        const batch = db.batch();\n        const chunk = productsData.slice(i, i + batchSize);\n        \n        for (const productData of chunk) {\n            try {\n                const docRef = productCollection.doc();\n                batch.set(docRef, { ...productData, createdAt: FieldValue.serverTimestamp() });\n                successCount++;\n            } catch (e) {\n                console.error(\"Error adding product to batch:\", productData.name, e);\n                errorCount++;\n            }\n        }\n        await batch.commit();\n    }\n\n    return { successCount, errorCount };\n}\n\n\nexport async function updateProduct(productId: string, productData: Partial<Product>, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const productRef = db.doc(`companies/${companyId}/products/${productId}`);\n    await productRef.update(productData);\n};\n\nexport async function deleteProduct(productId: string, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const productRef = db.doc(`companies/${companyId}/products/${productId}`);\n    await productRef.delete();\n};\n\n\n// -----------------\n// Order Draft Management\n// -----------------\nexport async function addOrderDraft(title: string, items: OrderItem[], totalCost: number, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const draftsCollection = db.collection(`companies/${companyId}/orderDrafts`);\n    await draftsCollection.add({\n        title,\n        items,\n        totalCost,\n        status: 'draft',\n        createdAt: FieldValue.serverTimestamp(),\n    });\n}\n\nexport async function deleteOrderDraft(draftId: string, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const draftRef = db.doc(`companies/${companyId}/orderDrafts/${draftId}`);\n    await draftRef.delete();\n}\n\nexport async function restockInventory(drafts: OrderDraft[], userId: string): Promise<string> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n\n    const consolidatedItems = new Map<string, number>();\n    let totalCost = 0;\n    \n    drafts.forEach(draft => {\n        totalCost += draft.totalCost;\n        draft.items.forEach(item => {\n            consolidatedItems.set(item.productId, (consolidatedItems.get(item.productId) || 0) + item.orderQuantity);\n        });\n    });\n\n    const newOutflow: Omit<CashOutflow, 'id'> = {\n        date: new Date().toISOString(),\n        amount: totalCost,\n        currency: 'NIO', // Assuming restock is always in NIO\n        cashBox: 'general',\n        reason: `Abastecimiento de inventario (${drafts.length} borrador/es)`,\n        type: 'restock',\n    };\n\n    const outflowId = await db.runTransaction(async (transaction) => {\n        // --- READS ---\n        const productRefs = Array.from(consolidatedItems.keys()).map(productId => db.doc(`companies/${companyId}/products/${productId}`));\n        const productDocs = productRefs.length > 0 ? await transaction.getAll(...productRefs) : [];\n        const productsToUpdate: { ref: FirebaseFirestore.DocumentReference, newStock: number }[] = [];\n\n        for (const productDoc of productDocs) {\n            const orderQuantity = consolidatedItems.get(productDoc.id);\n            if (productDoc.exists && orderQuantity) {\n                const currentStock = productDoc.data()?.quantity || 0;\n                const newStock = currentStock + orderQuantity;\n                productsToUpdate.push({ ref: productDoc.ref, newStock });\n            }\n        }\n        \n        // --- WRITES ---\n        // 1. Create the cash outflow document\n        const outflowRef = db.collection(`companies/${companyId}/cash_outflows`).doc();\n        transaction.set(outflowRef, newOutflow);\n        \n        // 2. Update stock for all products\n        productsToUpdate.forEach(p => {\n            transaction.update(p.ref, { quantity: p.newStock });\n        });\n\n        // 3. Mark drafts as completed\n        drafts.forEach(draft => {\n            const draftRef = db.doc(`companies/${companyId}/orderDrafts/${draft.id}`);\n            transaction.update(draftRef, { status: 'completed' });\n        });\n        \n        return outflowRef.id;\n    });\n\n    return outflowId;\n}\n\n\n// -----------------\n// Sales Management\n// -----------------\nexport async function addSale(newSale: Omit<Sale, 'id' | 'reviewNotes'>, cart: PlainCartItem[], userId: string): Promise<string> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    \n    const saleId = await db.runTransaction(async (transaction) => {\n        // --- 1. READS ---\n        const productRefs = cart.map(item => db.doc(`companies/${companyId}/products/${item.id}`));\n        const productDocs = productRefs.length > 0 ? await transaction.getAll(...productRefs) : [];\n        const productsToUpdate: { ref: FirebaseFirestore.DocumentReference, newStock: number }[] = [];\n\n        for (let i = 0; i < productDocs.length; i++) {\n            const productDoc = productDocs[i];\n            const cartItem = cart[i];\n\n            if (!productDoc.exists) {\n                throw new Error(`Producto con ID ${cartItem.id} no encontrado.`);\n            }\n\n            const currentStock = productDoc.data()?.quantity || 0;\n            const newStock = currentStock - cartItem.quantityInCart;\n\n            if (newStock < 0) {\n                throw new Error(`Stock insuficiente para ${productDoc.data()?.name}.`);\n            }\n            productsToUpdate.push({ ref: productDoc.ref, newStock });\n        }\n\n        // --- 2. WRITES ---\n        const salesCollection = db.collection(`companies/${companyId}/sales`);\n        const saleRef = salesCollection.doc();\n        transaction.set(saleRef, newSale);\n\n        productsToUpdate.forEach(p => {\n            transaction.update(p.ref, { quantity: p.newStock });\n        });\n        \n        return saleRef.id;\n    });\n\n    return saleId;\n};\n\nexport async function updateSaleAndAdjustStock(updatedSale: Sale, originalSale: Sale, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    \n    await db.runTransaction(async (transaction) => {\n        const saleRef = db.doc(`companies/${companyId}/sales/${updatedSale.id}`);\n        const productQuantityChanges: { [productId: string]: number } = {};\n\n        // Calculate deltas: Positive value means stock should increase (product returned)\n        originalSale.items.forEach(item => {\n            productQuantityChanges[item.productId] = (productQuantityChanges[item.productId] || 0) + item.quantity;\n        });\n\n        updatedSale.items.forEach(item => {\n            productQuantityChanges[item.productId] = (productQuantityChanges[item.productId] || 0) - item.quantity;\n        });\n\n        // --- READS ---\n        const productRefsToRead = Object.keys(productQuantityChanges)\n            .filter(productId => productQuantityChanges[productId] !== 0)\n            .map(productId => db.doc(`companies/${companyId}/products/${productId}`));\n        \n        const productDocs = productRefsToRead.length > 0 ? await transaction.getAll(...productRefsToRead) : [];\n        \n        // --- WRITES ---\n        const updates: { ref: FirebaseFirestore.DocumentReference, newStock: number }[] = [];\n\n        for (const productDoc of productDocs) {\n            if (!productDoc.exists) continue; // Skip if product somehow got deleted\n            const productId = productDoc.id;\n            const delta = productQuantityChanges[productId];\n            const currentStock = productDoc.data()?.quantity || 0;\n            const newStock = currentStock + delta;\n\n            if (newStock < 0) {\n                const productName = productDoc.data()?.name || productId;\n                throw new Error(`No se puede completar la actualización. El stock de \"${productName}\" sería negativo.`);\n            }\n            updates.push({ ref: productDoc.ref, newStock });\n        }\n\n        // Create refund outflow if necessary\n        const refundAmount = originalSale.grandTotal - updatedSale.grandTotal;\n        if (refundAmount > 0) {\n            const outflowRef = db.collection(`companies/${companyId}/cash_outflows`).doc();\n            transaction.set(outflowRef, {\n                date: new Date().toISOString(),\n                amount: refundAmount,\n                currency: originalSale.paymentCurrency,\n                cashBox: 'general',\n                reason: `Ajuste/reembolso de Venta ID: ${originalSale.id.substring(0,8)}...`,\n                type: 'adjustment' as const,\n            });\n        }\n        \n        // Update the sale document\n        transaction.update(saleRef, {\n            items: updatedSale.items,\n            grandTotal: updatedSale.grandTotal,\n            needsReview: false,\n            reviewNotes: FieldValue.delete() // Remove notes after review\n        });\n\n        // Apply stock updates\n        updates.forEach(update => {\n            transaction.update(update.ref, { quantity: update.newStock });\n        });\n    });\n};\n\nexport async function markSaleForReview(saleId: string, notes: string, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const saleRef = db.doc(`companies/${companyId}/sales/${saleId}`);\n    await saleRef.update({ needsReview: true, reviewNotes: notes });\n}\n\n// -----------------\n// Inventory Loss Management\n// -----------------\n\nexport async function adjustStockForLoss(productId: string, lostQuantity: number, reason: string, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n\n    await db.runTransaction(async (transaction) => {\n        const productRef = db.doc(`companies/${companyId}/products/${productId}`);\n        const productDoc = await transaction.get(productRef);\n\n        if (!productDoc.exists) {\n            throw new Error(\"El producto que intentas ajustar no existe.\");\n        }\n\n        const productData = productDoc.data() as Product;\n        const currentStock = productData.quantity;\n        const newStock = currentStock - lostQuantity;\n\n        if (newStock < 0) {\n            throw new Error(`La cantidad a dar de baja (${lostQuantity}) es mayor que el stock actual (${currentStock}).`);\n        }\n\n        const lossValue = productData.purchaseCost * lostQuantity;\n\n        const outflowRef = db.collection(`companies/${companyId}/cash_outflows`).doc();\n        transaction.set(outflowRef, {\n            date: new Date().toISOString(),\n            amount: lossValue,\n            currency: 'NIO', // Losses are always calculated in base currency\n            cashBox: 'general', // This is a virtual outflow from 'general' box\n            reason: `Pérdida de ${lostQuantity} ${productData.stockingUnit} de \"${productData.name}\": ${reason}`,\n            type: 'loss' as const,\n        });\n\n        transaction.update(productRef, { quantity: newStock });\n    });\n}\n\n\n// -----------------\n// Cash Flow & Reconciliation\n// -----------------\n\nexport async function addCashOutflow(outflow: Omit<CashOutflow, 'id'>, userId: string): Promise<string> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const outflowsCollection = db.collection(`companies/${companyId}/cash_outflows`);\n    const docRef = await outflowsCollection.add(outflow);\n    return docRef.id;\n};\n\nexport async function addWithdrawal(withdrawalData: Omit<CashOutflow, 'id'>, userId: string): Promise<string> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const outflowsCollection = db.collection(`companies/${companyId}/cash_outflows`);\n    \n    const outflowToCreate: Omit<CashOutflow, 'id'> = {\n        ...withdrawalData,\n        type: 'withdrawal',\n    };\n\n    const docRef = await outflowsCollection.add(outflowToCreate);\n    return docRef.id;\n}\n\nexport async function addInflow(inflow: Omit<Inflow, 'id'>, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const inflowsCollection = db.collection(`companies/${companyId}/inflows`);\n    await inflowsCollection.add(inflow);\n};\n\nexport async function addCashTransfer(transfer: Omit<CashTransfer, 'id'>, userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const transfersCollection = db.collection(`companies/${companyId}/cash_transfers`);\n    await transfersCollection.add(transfer);\n};\n\nexport async function updateReconciliationStatus(dateId: string, status: 'open' | 'closed', userId: string): Promise<void> {\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const reconRef = db.doc(`companies/${companyId}/reconciliations/${dateId}`);\n    await reconRef.set({\n        status: status,\n        updatedAt: FieldValue.serverTimestamp()\n    }, { merge: true });\n};\n\n\n// -----------------\n// Danger Zone\n// -----------------\n\nexport async function setCompanySecurityCode(password: string, securityCode: string, userId: string): Promise<void> {\n    const auth = getAdminAuthOrThrow();\n    const db = getAdminDbOrThrow();\n    \n    const { customClaims, email } = await auth.getUser(userId);\n\n    if (customClaims?.role !== 'primary-admin' || !email) {\n        throw new Error(\"Solo el propietario puede configurar un código de seguridad.\");\n    }\n    \n    try {\n        if (!clientAuth.currentUser) {\n            await signInWithEmailAndPassword(clientAuth, email, password);\n        }\n        const userCredential = EmailAuthProvider.credential(email, password);\n        await reauthenticateWithCredential(clientAuth.currentUser!, userCredential);\n    } catch(e) {\n        throw new Error(\"No se pudo reautenticar. La contraseña actual es incorrecta.\");\n    }\n\n    const companyId = await getCompanyIdForUser(userId);\n    const companyRef = db.doc(`companies/${companyId}`);\n    const securityDocRef = db.doc(`companies/${companyId}/private/security`);\n\n    await securityDocRef.set({ code: securityCode });\n    await companyRef.update({ securityCodeSet: true });\n}\n\nexport async function initiateCompanyWipe(password: string, securityCode: string, userId: string): Promise<any> {\n    const auth = getAdminAuthOrThrow();\n    const { email } = await auth.getUser(userId);\n    \n    if (!email) {\n        throw new Error(\"El usuario no tiene un email para reautenticar.\");\n    }\n\n    try {\n        if (!clientAuth.currentUser) {\n           await signInWithEmailAndPassword(clientAuth, email, password);\n        }\n        const userCredential = EmailAuthProvider.credential(email, password);\n        await reauthenticateWithCredential(clientAuth.currentUser!, userCredential);\n    } catch(e) {\n        throw new Error(\"No se pudo reautenticar. La contraseña actual es incorrecta.\");\n    }\n\n    const db = getAdminDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const securityDocRef = db.doc(`companies/${companyId}/private/security`);\n    const securityDoc = await securityDocRef.get();\n    \n    if (!securityDoc.exists || securityDoc.data()?.code !== securityCode) {\n        throw new Error(\"El código de seguridad es incorrecto.\");\n    }\n    \n    const functions = getFunctions(clientApp);\n    const wipeCompanyData: HttpsCallable = httpsCallable(functions, 'wipeCompanyData');\n\n    try {\n        const result = await wipeCompanyData();\n        return result.data;\n    } catch (error: any) {\n        console.error(\"Error al invocar la función de borrado:\", error);\n        throw new Error(error.message || \"Error desconocido al llamar a la función de borrado.\");\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAiCsB,sBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA","debugId":null}},
    {"offset": {"line": 254, "column": 0}, "map": {"version":3,"sources":["file:///home/user/tienda/src/lib/firestore-helpers.ts"],"sourcesContent":["\n\nimport { \n  collection, getDocs, doc, getDoc, query, orderBy, where, addDoc\n} from \"firebase/firestore\";\nimport { firestore as db } from \"./firebase/client\"; \nimport { Product, Sale, User, CashOutflow, Inflow, Reconciliation, Category, Company, CashTransfer, OrderDraft } from \"./types\";\nimport { getCompanyIdForUser as getServerCompanyIdForUser } from './actions/setup';\n\n\n// -----------------\n// Helpers internos\n// -----------------\nconst getClientDbOrThrow = () => {\n    if (!db) {\n        throw new Error(\"El cliente de Firebase Firestore no está configurado. Revisa tus variables de entorno NEXT_PUBLIC_*.\");\n    }\n    return db;\n};\n\n// This is a client-side helper to get companyId. Avoid using server actions on the client in helpers.\nasync function getCompanyIdForUser(userId: string): Promise<string> {\n  const db = getClientDbOrThrow();\n  const userRef = doc(db, \"users\", userId);\n  const userSnap = await getDoc(userRef);\n  if (!userSnap.exists() || !userSnap.data()?.companyId) {\n    // Fallback to server action if needed, but primarily use client SDK.\n    try {\n        return await getServerCompanyIdForUser(userId);\n    } catch(e) {\n        throw new Error(\"Usuario no asociado a ninguna empresa.\");\n    }\n  }\n  return userSnap.data()!.companyId;\n};\n\n// -----------------\n// User Management (Client-facing reads)\n// -----------------\nexport async function getUsers(userId: string): Promise<User[]> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const usersCollectionRef = collection(db, \"users\");\n    const q = query(usersCollectionRef, where(\"companyId\", \"==\", companyId), orderBy(\"name\"));\n    try {\n        const snapshot = await getDocs(q);\n        return snapshot.docs.map(doc => {\n            const data = doc.data();\n            const createdAt = data.createdAt?.toDate ? data.createdAt.toDate().toISOString() : new Date().toISOString();\n            return { ...data, id: doc.id, uid: doc.id, createdAt } as User;\n        });\n    } catch (error) {\n        console.error(\"Error al obtener los usuarios:\", error);\n        throw error;\n    }\n};\n\n// -----------------\n// Category Management (Client-facing reads)\n// -----------------\nexport async function getCategories(userId: string): Promise<Category[]> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const categoriesCollectionRef = collection(db, `companies/${companyId}/categories`);\n    const q = query(categoriesCollectionRef, orderBy(\"name\"));\n    try {\n        const snapshot = await getDocs(q);\n        return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id } as Category));\n    } catch (error) {\n        console.error(\"Error al obtener las categorías:\", error);\n        throw error;\n    }\n};\n\nexport async function addCategory(categoryName: string, userId: string): Promise<void> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const categoryCollection = collection(db, `companies/${companyId}/categories`);\n    await addDoc(categoryCollection, { name: categoryName });\n};\n\n// -----------------\n// Product Management (Client-facing reads)\n// -----------------\nexport async function getProducts(userId: string): Promise<Product[]> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const productsCollectionRef = collection(db, `companies/${companyId}/products`);\n    const q = query(productsCollectionRef, orderBy(\"name\"));\n    try {\n        const snapshot = await getDocs(q);\n        return snapshot.docs.map(doc => {\n            const data = doc.data();\n            const product = {\n                ...data,\n                id: doc.id,\n                createdAt: data.createdAt?.toDate ? data.createdAt.toDate().toISOString() : undefined,\n            } as Product;\n            return product;\n        });\n    } catch (error) {\n        console.error(\"Error al obtener los productos:\", error);\n        throw error;\n    }\n};\n\n\n// -----------------\n// Sales Management (Client-facing reads)\n// -----------------\nexport async function getSales(userId: string): Promise<Sale[]> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const salesCollectionRef = collection(db, `companies/${companyId}/sales`);\n    const q = query(salesCollectionRef, orderBy(\"date\", \"desc\"));\n    try {\n        const snapshot = await getDocs(q);\n        return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id } as Sale));\n    } catch (error) {\n        console.error(\"Error al obtener las ventas:\", error);\n        throw error;\n    }\n};\n\n// -----------------\n// Order Draft Management\n// -----------------\nexport async function getOrderDrafts(userId: string): Promise<OrderDraft[]> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const draftsCollectionRef = collection(db, `companies/${companyId}/orderDrafts`);\n    const q = query(draftsCollectionRef, where(\"status\", \"==\", \"draft\"), orderBy(\"createdAt\", \"desc\"));\n    try {\n        const snapshot = await getDocs(q);\n        return snapshot.docs.map(doc => {\n            const data = doc.data();\n            return {\n                ...data,\n                id: doc.id,\n                createdAt: data.createdAt?.toDate ? data.createdAt.toDate().toISOString() : new Date().toISOString(),\n            } as OrderDraft;\n        });\n    } catch (error) {\n        console.error(\"Error al obtener los borradores de pedidos:\", error);\n        throw error;\n    }\n}\n\n// -----------------\n// Cash Flow & Reconciliation (Client-facing reads)\n// -----------------\nasync function getSubcollection<T>(userId: string, subcollectionName: string): Promise<T[]> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const collectionRef = collection(db, `companies/${companyId}/${subcollectionName}`);\n    const q = query(collectionRef, orderBy(\"date\", \"desc\"));\n    try {\n        const snapshot = await getDocs(q);\n        return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id } as T));\n    } catch (error) {\n        console.error(`Error al obtener ${subcollectionName}:`, error);\n        throw error;\n    }\n};\n\nexport async function getCashOutflows(userId: string): Promise<CashOutflow[]> {\n    return getSubcollection<CashOutflow>(userId, \"cash_outflows\");\n};\n\nexport async function getInflows(userId: string): Promise<Inflow[]> {\n    return getSubcollection<Inflow>(userId, \"inflows\");\n};\n\nexport async function getCashTransfers(userId: string): Promise<CashTransfer[]> {\n    return getSubcollection<CashTransfer>(userId, \"cash_transfers\");\n}\n\nexport async function addInflow(inflow: Omit<Inflow, 'id'>, userId: string) {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const inflowsCollection = collection(db, `companies/${companyId}/inflows`);\n    await addDoc(inflowsCollection, inflow);\n}\n\nexport async function addCashOutflow(outflow: Omit<CashOutflow, 'id'>, userId: string): Promise<string> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const outflowsCollection = collection(db, `companies/${companyId}/cash_outflows`);\n    const docRef = await addDoc(outflowsCollection, outflow);\n    return docRef.id;\n}\n\nexport async function getReconciliationStatus(dateId: string, userId: string): Promise<Reconciliation['status']> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const reconDocRef = doc(db, `companies/${companyId}/reconciliations`, dateId);\n    try {\n        const docSnap = await getDoc(reconDocRef);\n        return docSnap.exists() ? docSnap.data().status || 'open' : 'open';\n    } catch (error) {\n        console.error(`Error al obtener el estado de la reconciliación para ${dateId}:`, error);\n        throw error;\n    }\n};\n\nexport async function getClosedReconciliations(userId: string): Promise<Reconciliation[]> {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const reconCollectionRef = collection(db, `companies/${companyId}/reconciliations`);\n    const q = query(reconCollectionRef, where(\"status\", \"==\", \"closed\"), orderBy(\"updatedAt\", \"desc\"));\n    try {\n        const snapshot = await getDocs(q);\n        return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id } as Reconciliation));\n    } catch (error) {\n        console.error(`Error al obtener las reconciliaciones cerradas:`, error);\n        throw error;\n    }\n};\n\nexport async function updateReconciliationStatus(dateId: string, status: 'open' | 'closed', userId: string) {\n    const db = getClientDbOrThrow();\n    const companyId = await getCompanyIdForUser(userId);\n    const reconRef = doc(db, `companies/${companyId}/reconciliations`, dateId);\n    // Note: This uses client-side set, which is fine for this action.\n    // For more complex transactions, a server action would be better.\n    await (await import(\"firebase/firestore\")).setDoc(reconRef, {\n        status,\n        updatedAt: new Date()\n    }, { merge: true });\n}\n\nexport { getCompanyIdForUser };\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 514, "column": 0}, "map": {"version":3,"sources":["file:///home/user/tienda/src/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,KAA4C;QAA5C,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB,GAA5C;IACb,qBACE,6LAAC;QAAI,WAAW,IAAA,4HAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE;KAJS","debugId":null}},
    {"offset": {"line": 563, "column": 0}, "map": {"version":3,"sources":["file:///home/user/tienda/src/components/ui/table.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,2KAAgB,MAG5B,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YACC,KAAK;YACL,WAAW,IAAA,4HAAE,EAAC,iCAAiC;YAC9C,GAAG,KAAK;;;;;;;;;;;;;AAIf,MAAM,WAAW,GAAG;AAEpB,MAAM,4BAAc,2KAAgB,OAGlC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QAAM,KAAK;QAAK,WAAW,IAAA,4HAAE,EAAC,mBAAmB;QAAa,GAAG,KAAK;;;;;;;;AAEzE,YAAY,WAAW,GAAG;AAE1B,MAAM,0BAAY,2KAAgB,OAGhC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,4BAAc,2KAAgB,OAGlC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,2DACA;QAED,GAAG,KAAK;;;;;;;;AAGb,YAAY,WAAW,GAAG;AAE1B,MAAM,yBAAW,2KAAgB,OAG/B,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,+EACA;QAED,GAAG,KAAK;;;;;;;;AAGb,SAAS,WAAW,GAAG;AAEvB,MAAM,0BAAY,2KAAgB,QAGhC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,oGACA;QAED,GAAG,KAAK;;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,0BAAY,2KAAgB,QAGhC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,kDAAkD;QAC/D,GAAG,KAAK;;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,6BAAe,2KAAgB,QAGnC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,sCAAsC;QACnD,GAAG,KAAK;;;;;;;;AAGb,aAAa,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 731, "column": 0}, "map": {"version":3,"sources":["file:///home/user/tienda/src/app/dashboard/page.tsx"],"sourcesContent":["\n\n\"use client\";\n\nimport { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport StatCard from '@/components/dashboard/stat-card';\nimport { Product, Sale, CashOutflow, Company } from '@/lib/types';\nimport { getProducts, getSales, getCashOutflows } from '@/lib/firestore-helpers';\nimport { useAuth } from '@/context/auth-context';\nimport { DollarSign, Package, AlertTriangle, ShoppingCart, TrendingUp, BarChart3, Eye, Flag, PackagePlus, ArrowRight, BookOpen, Wallet } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { isToday, format, isSameDay, formatDistanceToNow } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { SidebarTrigger } from '@/components/ui/sidebar';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\n\nexport default function DashboardPage() {\n  const { user, loading: authLoading } = useAuth();\n  const [products, setProducts] = useState<Product[]>([]);\n  const [sales, setSales] = useState<Sale[]>([]);\n  const company = user?.company;\n  const [outflows, setOutflows] = useState<CashOutflow[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [currentDate, setCurrentDate] = useState('');\n  const { toast } = useToast();\n  const router = useRouter();\n\n  const isAdmin = user?.role === 'admin' || user?.role === 'primary-admin';\n\n  useEffect(() => {\n    // Set current date on client-side to avoid hydration mismatch\n    if (typeof window !== 'undefined') {\n        const today = new Date();\n        const formattedDate = format(today, \"eeee, d 'de' MMMM 'de' yyyy\", { locale: es });\n        setCurrentDate(formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1));\n    }\n  }, []);\n\n  const fetchData = useCallback(async () => {\n    if (!user) return;\n    setLoading(true);\n    try {\n        const [productsData, salesData, outflowsData] = await Promise.all([\n            getProducts(user.uid),\n            getSales(user.uid),\n            getCashOutflows(user.uid)\n        ]);\n        setProducts(productsData);\n        setSales(salesData);\n        setOutflows(outflowsData);\n    } catch (error) {\n        console.error(\"Dashboard fetch error:\", error);\n        toast({ variant: 'destructive', title: 'Error', description: 'No se pudieron cargar los datos del panel de control.' });\n    } finally {\n        setLoading(false);\n    }\n  }, [toast, user]);\n\n  useEffect(() => {\n    if (!authLoading && user) {\n      fetchData();\n    } else if (!authLoading && !user) {\n      setLoading(false);\n    }\n  }, [user, authLoading, fetchData]);\n  \n  const formatCurrency = (amount: number, currency: 'NIO' | 'USD' = 'NIO') =>\n    new Intl.NumberFormat(\"es-NI\", {\n      style: \"currency\",\n      currency: currency,\n    }).format(amount);\n\n\n  const {\n    todayRevenue,\n    todaySalesCount,\n    totalProducts,\n    lowStockItems,\n    lowStockProducts,\n    employeeTodaySales,\n    todayProfit,\n    recentSales,\n    todaySalesInUSD,\n    salesForReview,\n    availableProfit,\n  } = useMemo(() => {\n    const today = new Date();\n    const todaySales = sales.filter(sale => isSameDay(new Date(sale.date), today));\n    const todayRevenue = todaySales.reduce((acc, sale) => acc + sale.grandTotal, 0);\n    const todaySalesCount = todaySales.length;\n    \n    const todaySalesInUSD = sales\n      .filter(sale => isSameDay(new Date(sale.date), today) && sale.paymentCurrency === 'USD')\n      .reduce((acc, sale) => acc + sale.grandTotal, 0);\n\n    const totalProducts = products.length;\n    const lowStockProducts = products.filter(p => p.quantity <= p.lowStockThreshold).sort((a,b) => a.quantity - b.quantity);\n    const lowStockItems = lowStockProducts.length;\n\n    const employeeTodaySales = sales.filter(sale => \n        sale.employeeId === user?.uid && isToday(new Date(sale.date))\n    );\n\n    const productsMap = new Map(products.map(p => [p.id, p]));\n    const calculateProfit = (sale: Sale) => {\n        return sale.items.reduce((currentSaleProfit, item) => {\n            const product = productsMap.get(item.productId);\n            const cost = product?.purchaseCost || 0;\n            return currentSaleProfit + ((item.salePrice - cost) * item.quantity);\n        }, 0);\n    }\n\n    const todayProfit = todaySales.reduce((totalProfit, sale) => totalProfit + calculateProfit(sale), 0);\n    \n    const recentSales = [...sales].sort((a,b) => new Date(b.date).getTime() - new Date(a.date).getTime()).slice(0,5);\n\n    const salesForReview = sales.filter(s => s.needsReview === true);\n\n    const totalAccumulatedProfit = sales.reduce((totalProfit, sale) => totalProfit + calculateProfit(sale), 0);\n    const totalWithdrawals = outflows\n      .filter(o => o.type === 'withdrawal' && o.currency === 'NIO') // Assuming withdrawals are always in NIO for simplicity\n      .reduce((sum, o) => sum + o.amount, 0);\n      \n    const availableProfit = totalAccumulatedProfit - totalWithdrawals;\n\n    return { \n        todayRevenue, todaySalesCount, totalProducts, lowStockItems, lowStockProducts, \n        employeeTodaySales, todayProfit,\n        recentSales, todaySalesInUSD, salesForReview,\n        availableProfit,\n    };\n\n  }, [sales, products, user, outflows]);\n\n  if (loading) {\n    return (\n      <div className=\"flex flex-col p-4 sm:p-6 lg:p-8 space-y-6\">\n        <header>\n           <Skeleton className=\"h-8 w-48\" />\n           <Skeleton className=\"h-4 w-72 mt-2\" />\n        </header>\n        <main className=\"flex-1 space-y-6\">\n            <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-5\">\n                <Skeleton className=\"h-28\" />\n                <Skeleton className=\"h-28\" />\n                <Skeleton className=\"h-28\" />\n                <Skeleton className=\"h-28\" />\n                <Skeleton className=\"h-28\" />\n            </div>\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              <Skeleton className=\"h-64\" />\n              <Skeleton className=\"h-64\" />\n            </div>\n             <Skeleton className=\"h-48\" />\n        </main>\n      </div>\n    );\n  }\n  \n  const unitLabels: Record<Product['stockingUnit'], string> = {\n    unidad: 'u',\n    lb: 'lb',\n    oz: 'oz',\n    L: 'L',\n    kg: 'kg',\n    qq: 'qq'\n  };\n\n\n  const welcomeMessage = user ? `Bienvenido de nuevo, ${user.name.split(' ')[0]}` : \"Dashboard\";\n  const welcomeDescription = \"Aquí tienes un resumen de la actividad de tu tienda.\";\n\n  const renderAdminDashboard = () => (\n    <>\n      <div className=\"grid gap-4 md:gap-6 sm:grid-cols-2 lg:grid-cols-5\">\n        <StatCard\n          title=\"Ganancias Disponibles\"\n          value={formatCurrency(availableProfit)}\n          icon={Wallet}\n          description=\"Capital que puedes retirar.\"\n          variant=\"info\"\n        />\n        <StatCard\n          title=\"Ventas de Hoy (C$)\"\n          value={formatCurrency(todayRevenue)}\n          icon={TrendingUp}\n          description={`${todaySalesCount} transacciones`}\n          variant=\"success\"\n        />\n        <StatCard\n            title=\"Beneficio de Hoy\"\n            value={formatCurrency(todayProfit)}\n            icon={DollarSign}\n            description=\"Ganancia neta estimada\"\n            variant=\"success\"\n        />\n        <StatCard\n          title=\"Total Productos\"\n          value={totalProducts.toString()}\n          icon={Package}\n          description=\"Tipos de producto en inventario\"\n          variant=\"info\"\n        />\n        <StatCard\n          title=\"Ventas para Revisión\"\n          value={salesForReview.length.toString()}\n          icon={Flag}\n          description={`Ventas marcadas por empleados`}\n          variant={salesForReview.length > 0 ? 'destructive' : 'info'}\n        />\n      </div>\n\n       <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-6\">\n            <Card className=\"lg:col-span-3 backdrop-blur-sm bg-background/50\">\n                <CardHeader>\n                    <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                           <ShoppingCart className=\"text-primary h-5 w-5\" />\n                           <CardTitle className=\"text-lg font-semibold\">Últimas Ventas</CardTitle>\n                        </div>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => router.push('/dashboard/sales')}>\n                            Ver Todas\n                            <Eye className=\"ml-2 h-4 w-4\" />\n                        </Button>\n                    </div>\n                    <CardDescription>Un vistazo rápido a las transacciones más recientes.</CardDescription>\n                </CardHeader>\n                <CardContent>\n                     {recentSales.length > 0 ? (\n                        <div className=\"space-y-4\">\n                            {recentSales.map(sale => (\n                                <div key={sale.id} className=\"flex justify-between items-center hover:bg-muted/50 p-2 rounded-md transition-colors\">\n                                    <div className=\"flex items-center gap-3\">\n                                         <div className=\"p-2 bg-muted rounded-full\">\n                                            <ShoppingCart className=\"h-4 w-4 text-muted-foreground\"/>\n                                         </div>\n                                         <div>\n                                            <p className=\"font-medium text-sm truncate max-w-[200px]\" title={sale.id}>Transacción #{sale.id.substring(0, 8)}...</p>\n                                            <p className=\"text-xs text-muted-foreground\">\n                                                {formatDistanceToNow(new Date(sale.date), { addSuffix: true, locale: es })} por {sale.employeeName}\n                                            </p>\n                                         </div>\n                                    </div>\n                                    <div className=\"text-right\">\n                                        <p className=\"font-bold text-sm\">{formatCurrency(sale.grandTotal, sale.paymentCurrency)}</p>\n                                        <Badge variant={sale.paymentCurrency === 'USD' ? 'secondary' : 'outline'}>{sale.paymentCurrency}</Badge>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    ) : (\n                        <div className=\"text-sm text-muted-foreground text-center py-8\">\n                            <ShoppingCart className=\"mx-auto h-8 w-8 mb-2\" />\n                            Aún no se han realizado ventas.\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n            <div className=\"lg:col-span-2 grid grid-cols-1 gap-6 auto-rows-min\">\n              <Card className=\"backdrop-blur-sm bg-background/50\">\n                  <CardHeader>\n                      <div className=\"flex items-center gap-2\">\n                        <CardTitle className=\"text-lg font-semibold\">Atajos</CardTitle>\n                      </div>\n                      <CardDescription>Navega rápidamente a las secciones principales.</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"grid grid-cols-2 gap-3 text-sm\">\n                      <Link href=\"/dashboard/pos\" passHref>\n                          <Button variant=\"outline\" className=\"w-full justify-start h-12 text-base font-semibold hover:bg-primary/10 hover:scale-105 hover:border-primary transition-all duration-200\">\n                              <ShoppingCart className=\"mr-2\"/> Nueva Venta\n                          </Button>\n                      </Link>\n                       <Link href=\"/dashboard/orders\" passHref>\n                          <Button variant=\"secondary\" className=\"w-full justify-start h-12 text-base font-semibold hover:scale-105 transition-transform duration-200\">\n                              <PackagePlus className=\"mr-2\"/> Pedidos\n                          </Button>\n                      </Link>\n                       <Link href=\"/dashboard/inventory\" passHref>\n                          <Button variant=\"secondary\" className=\"w-full justify-start h-12 text-base font-semibold hover:scale-105 transition-transform duration-200\">\n                              <Package className=\"mr-2\"/> Inventario\n                          </Button>\n                      </Link>\n                       <Link href=\"/dashboard/reports\" passHref>\n                          <Button variant=\"secondary\" className=\"w-full justify-start h-12 text-base font-semibold hover:scale-105 transition-transform duration-200\">\n                              <BarChart3 className=\"mr-2\"/> Reportes\n                          </Button>\n                      </Link>\n                  </CardContent>\n              </Card>\n              <Card className=\"backdrop-blur-sm bg-background/50\">\n                  <CardHeader>\n                      <div className=\"flex items-center gap-2\">\n                        <AlertTriangle className=\"text-destructive h-5 w-5\" />\n                        <CardTitle className=\"text-lg font-semibold\">Productos con Stock Bajo</CardTitle>\n                      </div>\n                      <CardDescription>Estos productos necesitan reabastecimiento pronto.</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                      {lowStockProducts.length > 0 ? (\n                          <div className=\"space-y-4\">\n                              {lowStockProducts.slice(0,2).map(p => (\n                                  <div key={p.id} className=\"flex justify-between items-center hover:bg-muted/50 p-2 rounded-md transition-colors\">\n                                      <div>\n                                          <p className=\"font-medium\">{p.name}</p>\n                                          <p className=\"text-sm text-muted-foreground\">{formatCurrency(p.salePrice)}</p>\n                                      </div>\n                                      <Badge variant=\"destructive\">{p.quantity} {unitLabels[p.stockingUnit] || p.stockingUnit} restantes</Badge>\n                                  </div>\n                              ))}\n                          </div>\n                      ) : (\n                          <div className=\"text-sm text-muted-foreground text-center py-8\">\n                            <Package className=\"mx-auto h-8 w-8 mb-2\" />\n                            ¡Excelente! No hay productos con bajo stock.\n                          </div>\n                      )}\n                  </CardContent>\n              </Card>\n            </div>\n      </div>\n      \n        {salesForReview.length > 0 && (\n             <Card className=\"backdrop-blur-sm bg-destructive/10 border-destructive\">\n                <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-destructive\">\n                    <Flag />\n                    Ventas Pendientes de Revisión\n                </CardTitle>\n                <CardDescription>\n                    Las siguientes ventas fueron marcadas por un empleado y necesitan tu atención.\n                </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    <Table>\n                        <TableHeader>\n                            <TableRow>\n                                <TableHead>ID Venta</TableHead>\n                                <TableHead>Empleado</TableHead>\n                                <TableHead>Fecha</TableHead>\n                                <TableHead className=\"text-right\">Total</TableHead>\n                                <TableHead className=\"text-center\">Acción</TableHead>\n                            </TableRow>\n                        </TableHeader>\n                         <TableBody>\n                            <TooltipProvider>\n                                {salesForReview.map(sale => (\n                                    <Tooltip key={sale.id} delayDuration={100}>\n                                        <TableRow>\n                                            <TooltipTrigger asChild>\n                                                <TableCell className=\"font-mono text-xs cursor-help\">{sale.id.substring(0,8)}...</TableCell>\n                                            </TooltipTrigger>\n                                            <TableCell>{sale.employeeName}</TableCell>\n                                            <TableCell>{format(new Date(sale.date), 'Pp', { locale: es })}</TableCell>\n                                            <TableCell className=\"text-right font-medium\">{formatCurrency(sale.grandTotal, sale.paymentCurrency)}</TableCell>\n                                            <TableCell className=\"text-center\">\n                                                <Button size=\"sm\" onClick={() => router.push('/dashboard/sales')}>\n                                                    Revisar en Historial\n                                                </Button>\n                                            </TableCell>\n                                        </TableRow>\n                                        {sale.reviewNotes && (\n                                            <TooltipContent side=\"top\" className=\"max-w-xs\">\n                                                <p className=\"font-bold\">Motivo de revisión:</p>\n                                                <p>{sale.reviewNotes}</p>\n                                            </TooltipContent>\n                                        )}\n                                    </Tooltip>\n                                ))}\n                            </TooltipProvider>\n                        </TableBody>\n                    </Table>\n                </CardContent>\n            </Card>\n        )}\n    </>\n  );\n\n  const renderEmployeeDashboard = () => (\n    <Card className=\"backdrop-blur-sm bg-background/50\">\n      <CardHeader>\n        <CardTitle>Mis Ventas de Hoy</CardTitle>\n        <CardDescription>Un resumen de las ventas que has realizado hoy.</CardDescription>\n      </CardHeader>\n      <CardContent>\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>ID de Transacción</TableHead>\n              <TableHead className=\"text-right\">Total</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {employeeTodaySales.length > 0 ? (\n              employeeTodaySales.map(sale => (\n                <TableRow key={sale.id}>\n                  <TableCell className=\"font-medium truncate max-w-[200px]\">{sale.id}</TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(sale.grandTotal, sale.paymentCurrency)}\n                  </TableCell>\n                </TableRow>\n              ))\n            ) : (\n              <TableRow>\n                <TableCell colSpan={2} className=\"h-24 text-center\">\n                  Aún no has realizado ninguna venta hoy.\n                </TableCell>\n              </TableRow>\n            )}\n          </TableBody>\n        </Table>\n      </CardContent>\n    </Card>\n  );\n\n  return (\n    <div className=\"relative min-h-full w-full overflow-hidden flex flex-col\">\n        {/* Animated background */}\n        <div className=\"absolute inset-0 -z-10 h-full w-full bg-white bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:14px_24px] dark:bg-neutral-950 dark:bg-[linear-gradient(to_right,#ffffff0d_1px,transparent_1px),linear-gradient(to_bottom,#ffffff0d_1px,transparent_1px)]\">\n            <div className=\"absolute left-0 right-0 top-0 -z-10 m-auto h-[310px] w-[310px] rounded-full bg-blue-400 opacity-20 blur-[100px]\"></div>\n        </div>\n\n      <div className=\"flex-1 flex flex-col p-4 sm:p-6 lg:p-8\">\n        <header className=\"mb-6 flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n                <SidebarTrigger className=\"hidden md:flex\"/>\n                <div>\n                    <h1 className=\"text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-50\">\n                        {welcomeMessage}\n                    </h1>\n                    <p className=\"text-lg text-muted-foreground\">\n                        {isAdmin \n                        ? welcomeDescription\n                        : \"Aquí tienes un resumen de tu actividad de hoy.\"\n                        }\n                    </p>\n                </div>\n            </div>\n            <p className=\"text-sm font-medium text-muted-foreground mt-2 sm:mt-0\">\n                {currentDate}\n            </p>\n        </header>\n        <main className=\"flex-1 space-y-6\">\n          {isAdmin ? renderAdminDashboard() : renderEmployeeDashboard()}\n        </main>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}